<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Mega Brain Dashboard</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, sans-serif;
            background: linear-gradient(135deg, #0a0e27 0%, #1a1d3a 100%);
            color: #e0e0e0;
            min-height: 100vh;
            padding: 20px;
        }

        .container {
            max-width: 1400px;
            margin: 0 auto;
        }

        header {
            text-align: center;
            margin-bottom: 40px;
            padding: 30px 0;
            border-bottom: 2px solid rgba(255,255,255,0.1);
        }

        h1 {
            font-size: 3em;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            margin-bottom: 10px;
        }

        .subtitle {
            color: #888;
            font-size: 1.2em;
        }

        .status-badge {
            display: inline-block;
            padding: 8px 20px;
            border-radius: 20px;
            font-weight: bold;
            margin: 15px 0;
            animation: pulse 2s infinite;
        }

        .status-active {
            background: linear-gradient(135deg, #00ff88 0%, #00cc66 100%);
            color: #0a0e27;
        }

        @keyframes pulse {
            0%, 100% { opacity: 1; }
            50% { opacity: 0.7; }
        }

        .dashboard-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(350px, 1fr));
            gap: 20px;
            margin-bottom: 20px;
        }

        .card {
            background: rgba(255,255,255,0.05);
            border: 1px solid rgba(255,255,255,0.1);
            border-radius: 15px;
            padding: 25px;
            backdrop-filter: blur(10px);
            transition: all 0.3s ease;
        }

        .card:hover {
            transform: translateY(-5px);
            box-shadow: 0 10px 30px rgba(102, 126, 234, 0.3);
            border-color: rgba(102, 126, 234, 0.5);
        }

        .card-header {
            display: flex;
            align-items: center;
            justify-content: space-between;
            margin-bottom: 20px;
        }

        .card-title {
            font-size: 1.3em;
            font-weight: bold;
            color: #fff;
        }

        .card-icon {
            font-size: 2em;
        }

        .metric {
            display: flex;
            justify-content: space-between;
            padding: 12px 0;
            border-bottom: 1px solid rgba(255,255,255,0.05);
        }

        .metric:last-child {
            border-bottom: none;
        }

        .metric-label {
            color: #aaa;
        }

        .metric-value {
            font-weight: bold;
            color: #fff;
        }

        .metric-value.good {
            color: #00ff88;
        }

        .metric-value.warning {
            color: #ffaa00;
        }

        .metric-value.error {
            color: #ff4444;
        }

        .agent-list {
            max-height: 300px;
            overflow-y: auto;
        }

        .agent-item {
            padding: 10px;
            margin: 8px 0;
            background: rgba(255,255,255,0.03);
            border-radius: 8px;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .agent-status {
            width: 10px;
            height: 10px;
            border-radius: 50%;
            display: inline-block;
            margin-right: 10px;
        }

        .agent-status.running {
            background: #00ff88;
            box-shadow: 0 0 10px #00ff88;
        }

        .agent-status.stopped {
            background: #ff4444;
        }

        .loading {
            text-align: center;
            padding: 40px;
            color: #888;
        }

        .spinner {
            border: 3px solid rgba(255,255,255,0.1);
            border-top: 3px solid #667eea;
            border-radius: 50%;
            width: 40px;
            height: 40px;
            animation: spin 1s linear infinite;
            margin: 0 auto 20px;
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        .activity-feed {
            max-height: 400px;
            overflow-y: auto;
        }

        .activity-item {
            padding: 15px;
            margin: 10px 0;
            background: rgba(255,255,255,0.03);
            border-left: 3px solid #667eea;
            border-radius: 5px;
        }

        .activity-time {
            font-size: 0.85em;
            color: #888;
            margin-bottom: 5px;
        }

        .activity-text {
            color: #ddd;
        }

        ::-webkit-scrollbar {
            width: 8px;
        }

        ::-webkit-scrollbar-track {
            background: rgba(255,255,255,0.05);
            border-radius: 10px;
        }

        ::-webkit-scrollbar-thumb {
            background: rgba(102, 126, 234, 0.5);
            border-radius: 10px;
        }

        ::-webkit-scrollbar-thumb:hover {
            background: rgba(102, 126, 234, 0.7);
        }
    </style>
</head>
<body>
    <div class="container">
        <header>
            <h1>üß† MEGA BRAIN</h1>
            <p class="subtitle">Autonomous Intelligence System</p>
            <div class="status-badge status-active" id="statusBadge">‚óè ACTIVE</div>
        </header>

        <div class="dashboard-grid">
            <!-- System Health -->
            <div class="card">
                <div class="card-header">
                    <span class="card-title">System Health</span>
                    <span class="card-icon">üíö</span>
                </div>
                <div id="systemHealth" class="loading">
                    <div class="spinner"></div>
                    <p>Loading system health...</p>
                </div>
            </div>

            <!-- Active Agents -->
            <div class="card">
                <div class="card-header">
                    <span class="card-title">Active Agents</span>
                    <span class="card-icon">ü§ñ</span>
                </div>
                <div id="activeAgents" class="loading">
                    <div class="spinner"></div>
                    <p>Loading agents...</p>
                </div>
            </div>

            <!-- Strategic Decisions -->
            <div class="card">
                <div class="card-header">
                    <span class="card-title">Recent Decisions</span>
                    <span class="card-icon">üéØ</span>
                </div>
                <div id="decisions" class="loading">
                    <div class="spinner"></div>
                    <p>Loading decisions...</p>
                </div>
            </div>

            <!-- Learning Progress -->
            <div class="card">
                <div class="card-header">
                    <span class="card-title">Active Learning</span>
                    <span class="card-icon">üìö</span>
                </div>
                <div id="learning" class="loading">
                    <div class="spinner"></div>
                    <p>Loading learning progress...</p>
                </div>
            </div>

            <!-- Personal Context -->
            <div class="card">
                <div class="card-header">
                    <span class="card-title">Personal Context</span>
                    <span class="card-icon">üë§</span>
                </div>
                <div id="personalContext" class="loading">
                    <div class="spinner"></div>
                    <p>Loading context...</p>
                </div>
            </div>

            <!-- Activity Feed -->
            <div class="card">
                <div class="card-header">
                    <span class="card-title">Live Activity</span>
                    <span class="card-icon">‚ö°</span>
                </div>
                <div id="activity" class="loading">
                    <div class="spinner"></div>
                    <p>Loading activity...</p>
                </div>
            </div>
        </div>
    </div>

    <script>
        // API endpoints
        const API_BASE = window.location.origin + '/api/megabrain';

        // Fetch dashboard data
        async function fetchDashboardData() {
            try {
                // System health
                const healthRes = await fetch(`${API_BASE}/dashboard`);
                const healthData = await healthRes.json();
                updateSystemHealth(healthData);

                // Active learning
                const learningRes = await fetch(`${API_BASE}/active-learning`);
                const learningData = await learningRes.json();
                updateLearning(learningData);

                // Personal context
                const contextRes = await fetch(`${API_BASE}/personal-context`);
                const contextData = await contextRes.json();
                updatePersonalContext(contextData);

                // Cloud decisions
                const decisionsRes = await fetch(`${API_BASE}/cloud-strategist`);
                const decisionsData = await decisionsRes.json();
                updateDecisions(decisionsData);

            } catch (error) {
                console.error('Error fetching dashboard data:', error);
            }
        }

        function updateSystemHealth(data) {
            const container = document.getElementById('systemHealth');
            if (data.success) {
                container.innerHTML = `
                    <div class="metric">
                        <span class="metric-label">Status</span>
                        <span class="metric-value good">Operational</span>
                    </div>
                    <div class="metric">
                        <span class="metric-label">Agents Running</span>
                        <span class="metric-value">${data.agents?.total || 0}</span>
                    </div>
                    <div class="metric">
                        <span class="metric-label">Last Sync</span>
                        <span class="metric-value">${data.last_sync || 'Just now'}</span>
                    </div>
                    <div class="metric">
                        <span class="metric-label">Health Score</span>
                        <span class="metric-value good">${data.health_score || 100}/100</span>
                    </div>
                `;
            } else {
                container.innerHTML = '<p>No health data available</p>';
            }
        }

        function updateLearning(data) {
            const container = document.getElementById('learning');
            if (data.success && data.progress) {
                const stats = data.stats || {};
                container.innerHTML = `
                    <div class="metric">
                        <span class="metric-label">Tasks Attempted</span>
                        <span class="metric-value">${stats.attempted || 0}</span>
                    </div>
                    <div class="metric">
                        <span class="metric-label">Tasks Completed</span>
                        <span class="metric-value good">${stats.completed || 0}</span>
                    </div>
                    <div class="metric">
                        <span class="metric-label">Completion Rate</span>
                        <span class="metric-value">${stats.completion_rate || '0%'}</span>
                    </div>
                    <div class="metric">
                        <span class="metric-label">Learnings Extracted</span>
                        <span class="metric-value">${stats.learnings || 0}</span>
                    </div>
                `;
            } else {
                container.innerHTML = '<p>Learning system initializing...</p>';
            }
        }

        function updatePersonalContext(data) {
            const container = document.getElementById('personalContext');
            if (data.success && data.stats) {
                container.innerHTML = `
                    <div class="metric">
                        <span class="metric-label">Goals Tracked</span>
                        <span class="metric-value">${data.stats.goals_count || 0}</span>
                    </div>
                    <div class="metric">
                        <span class="metric-label">Core Values</span>
                        <span class="metric-value">${data.stats.values_count || 0}</span>
                    </div>
                    <div class="metric">
                        <span class="metric-label">Active Plans</span>
                        <span class="metric-value">${data.stats.plans_count || 0}</span>
                    </div>
                    <div class="metric">
                        <span class="metric-label">Life Story</span>
                        <span class="metric-value ${data.stats.has_life_story ? 'good' : 'warning'}">
                            ${data.stats.has_life_story ? '‚úì Complete' : 'Building...'}
                        </span>
                    </div>
                `;
            } else {
                container.innerHTML = '<p>Personal context building...</p>';
            }
        }

        function updateDecisions(data) {
            const container = document.getElementById('decisions');
            if (data.success && data.decisions && data.decisions.length > 0) {
                const recent = data.decisions.slice(-5).reverse();
                container.innerHTML = '<div class="activity-feed">' + recent.map(d => `
                    <div class="activity-item">
                        <div class="activity-time">${new Date(d.timestamp).toLocaleString()}</div>
                        <div class="activity-text"><strong>${d.action}</strong>: ${d.reason}</div>
                    </div>
                `).join('') + '</div>';
            } else {
                container.innerHTML = '<p>No decisions yet</p>';
            }
        }

        // Initial load
        fetchDashboardData();

        // Auto-refresh every 30 seconds
        setInterval(fetchDashboardData, 30000);
    </script>
</body>
</html>
